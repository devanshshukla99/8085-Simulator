{% extends "base.html" %}
{% block title %}8085 Simulator {% endblock %}
{% block head %}
<!-- CSS only -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
<script>
    window.onload = function () {
        console.log("load")
        document.getElementById("run").disabled = true
        document.getElementById("assemble").addEventListener("click", function () {
            console.log("assemble")
            const request = new XMLHttpRequest();
            request.open("POST", `/assemble`);
            request.onload = () => {
                const response = request.responseText;
                console.log(request.status)
                if (request.status != 200) {
                    alert(response)
                }
                else {
                    document.getElementById("run").disabled = false
                    document.getElementById("memory-container").innerHTML = response;
                }
            };
            let _code = document.getElementById("code").value
            if (_code) {
                console.log("sent")
                request.send(_code);
            }
        });
        document.getElementById("run").addEventListener("click", function () {
            console.log("run")
            const request = new XMLHttpRequest();
            request.open("POST", `/run`);
            request.onload = () => {
                const response = request.responseText;
                if (request.status != 200) {
                    alert(response)
                }
                else {
                    document.getElementById("registers-flags").innerHTML = response;
                }
            };
            let _code = document.getElementById("code").value
            request.send(_code);
        });
        document.getElementById("reset").addEventListener("click", function () {
            console.log("reset")
            const request = new XMLHttpRequest();
            request.open("POST", `/reset`);
            request.onload = () => {
                const response = request.responseText;
                if (request.status != 200) {
                    alert(response)
                }
                else {
                    const _resp_dict = JSON.parse(response)
                    document.getElementById("registers-flags").innerHTML = _resp_dict["registers_flags"];
                    document.getElementById("memory-container").innerHTML = _resp_dict["memory"];
                    document.getElementById("run").disabled = true
                }
            };
            request.send();
        });
    }
</script>
{% endblock %}
{% block body %}
<div class="main">
    <div class="registers-flags" id="registers-flags">
        {% include "render_registers_flags.html" %}
    </div>
    <div class="memory-container item3" id="memory-container">
        {% include "render_memory.html" %}
    </div>

    <div class="code-container item4">
        <div class="button-head">
            <button type="button" class="btn btn-primary btn-sm" id="assemble">Assemble</button>
            <button type="button" class="btn btn-success btn-sm" id="run">Run</button>
            <button type="button" class="btn btn-danger btn-sm" id="reset">Reset</button>
        </div>
        <div class="form-group">
            <textarea class="form-control" name="code" id="code" rows="25" style="max-width: 100%;"
                autocomplete="new-password"></textarea>
        </div>
    </div>
</div>
{% endblock %}